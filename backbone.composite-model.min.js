(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(["underscore","backbone"],t)}else if(typeof module==="object"&&module.exports){module.exports=t(require("underscore"),require("backbone"))}else{e.returnExports=t(e._,e.Backbone)}})(this,function(e,t){"use strict";t.mixinCompositeModel=function(o){var i=o.set,r=o.toJSON;return e.extend(o,{makeComposite:function(t){t=e.extend({create:true},t);this._compositeMap=this._createCompositeMap(t);this._updateComposite(this.attributes,t);return this},set:function(e,t,o){var r;if(e==null){return this}if(typeof e==="object"){r=e;o=t}else{(r={})[e]=t}o||(o={});var n=i.call(this,r,o);if(n&&this._compositeMap){this._updateComposite(r,o)}return n},toJSON:function(t){var o=r.call(this,t);if(this._compositeMap){e.each(this._compositeMap,function(e,t){var i=this[e.property];if(i){o[t]=i.toJSON()}},this)}return o},_createCompositeMap:function(i){var r=this.composite,n=i.composite;if(typeof r==="function"){r=r.call(this,i)}if(typeof n==="function"){n=n.call(this,i)}if(r&&typeof r!=="object"||n&&typeof n!=="object"){throw new Error("Invalid composite configuration")}var s=e.extend({},r,n);return e.reduce(s,function(e,i,r){var n,s,p;if(i.prototype instanceof t.Model||i.prototype instanceof t.Collection){n=r}else{if(typeof i!=="object"){throw new Error("Invalid composite child descriptor")}n=i.property||r;s=i.parse;if(s!=null&&typeof s!=="function"){throw new Error("Invalid child model data parse function")}p=i.method;i=i.type;if(!(i.prototype instanceof t.Model||i.prototype instanceof t.Collection)){throw new Error("Invalid composite child model")}}if(o[n]){throw new Error("Property conflict in the composite prototype")}if(!p){p=i.prototype instanceof t.Model?"set":"add"}if(!i.prototype[p]){throw new Error("Invalid chidl model data updating method")}e[r]={model:i,property:n,parse:s,method:p};return e},{})},_updateComposite:function(o,i){function r(t,o){var r=e.extend({},t.options,i);this[t.property]=new t.model(o,r)}function n(e){var o=this[e.property];if(o){if(i.unset||i.parse&&!i.validate){if(o instanceof t.Model){o.clear(i)}else{o.reset(undefined,i)}}}else if(i.create){r.call(this,e)}}function s(o,n){if(o.parse){n=o.parse.call(this,n,i)}var s=this[o.property];if(s){if(i.parse&&!i.validate){if(s instanceof t.Model){var p=e.omit(s.attributes,e.keys(n));s.set(p,{unset:true,silent:true})}else{s.reset(undefined,{silent:true})}}s[o.method](n,i)}else{r.call(this,o,n)}}e.each(this._compositeMap,function(t,i){if(e.has(o,i)){var r=o[i];if(r!=null){s.call(this,t,r)}else{n.call(this,t)}}else{n.call(this,t)}},this)}})};return t.mixinCompositeModel});
//# sourceMappingURL=backbone.composite-model.min.map